<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" href="icon/X.png" type="image/x-icon" />
	<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
	<title>Xprice</title>
	
	<!-- Icon css link -->
	<link href="css/font-awesome.min.css" rel="stylesheet">
	<!-- Bootstrap -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<!-- Extra plugin css -->
	<link href="css.css" rel="stylesheet" type="text/css">
	<link href="css/style.css" rel="stylesheet">
	<link href="css/responsive.css" rel="stylesheet">
	<!-- font-family -->
	<script src="https://kit.fontawesome.com/04ee868bb6.js" crossorigin="anonymous"></script>
	<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&family=Noto+Sans+TC:wght@400;900&family=Noto+Serif+TC:wght@600&family=Oswald:wght@500&display=swap" rel="stylesheet">
	<!-- confirm  -->
	<link href="http://cdn.kendostatic.com/2013.2.716/styles/kendo.common.min.css" 
	rel="stylesheet" type="text/css" />
	<link href="http://cdn.kendostatic.com/2013.2.716/styles/kendo.default.min.css" 
	rel="stylesheet" type="text/css" />
	<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.9.1.js"></script>
	<script src="http://cdn.kendostatic.com/2013.2.716/js/kendo.web.min.js"></script>
	<link href="css.css" rel="stylesheet" type="text/css">
	<style>
		.cnfrm-msg { color: red; padding: 30px; font-size: 12pt; }

	</style>
	<!-- confirm -->
</head>
<style>
	.alert {
			display: none;
			position: fixed;
			top: 50%;
			left: 50%;
			min-width: 200px;
			margin-left: -100px;
			z-index: 99999;
			padding: 15px;
			border: 1px solid transparent;
			border-radius: 4px;
		}
</style>
 
<script>//原版
function ajax(dic, addinto){
	$.ajax({
			type: "POST",
			url: "prize.php",
			data: dic,
			dataType: 'html' 
		}).done(function(data) {
			$(addinto).html(data).show();
			console.log('data is good');
		}).fail(function(jqXHR, textStatus, errorThrown) {	
			alert("something wrong check the console");
			console.log(jqXHR.responseText);
		});
}
$(document).ready(function() {
	//get personal imfor
	dic = {}
	dic['getimform'] = true
	ajax(dic, "#personal_inform")
	dic = {}
	dic['getprize'] = true
	ajax(dic, "#prize")
});

function exchange(pid){
	$.ajax({
			type: "POST",
			url: "prize.php",
			data: {exchange : true,
				   pid : pid},
			dataType: 'html' 
		}).done(function(data) {
			if (data == 1 ){
				console.log(data)
				$('.alert').html('成功兌換').addClass('alert-success').show().delay(1000).fadeOut();
			}
			else if(data == 2){
				$('.alert').html('該商品已無庫存!').addClass('alert-success').show().delay(1000).fadeOut();
			}
			else if(data == 0){
				console.log(data)
				$('.alert').html('您沒有足夠的X幣').addClass('alert-success').show().delay(1000).fadeOut();
			}
			//$(addinto).html(data).show();
			//console.log('data is good');
		}).fail(function(jqXHR, textStatus, errorThrown) {	
			alert("something wrong check the console");
			console.log(jqXHR.responseText);
		});
		//顯示個人資訊
		dic = {}
		dic['getimform'] = true
		ajax(dic, "#personal_inform")
		//取得商品資訊
		dic = {}
		dic['getprize'] = true
		ajax(dic, "#prize")
}

//確認視窗
(function($) {
      var h = [];
	  h.push("<div class='cnfrm-block'>");
      h.push("<div class='cnfrm-msg'></div>");
      h.push("<input type='button' class='cnfrm-yes' />");
      h.push("<input type='button' class='cnfrm-no' />");
      h.push("</div>");
      var html = h.join("");
      
      $.kendoConfirm = function(title, msg, yesText, noText) {
        var $div = $(html);
        $div.find(".cnfrm-msg").text(msg);
        $div.find(".cnfrm-yes").val(yesText || "Yes");
        $div.find(".cnfrm-no").val(noText || "No");
        var win = $div.kendoWindow({
          title: title || "Confirmation",
          resizable: false,
          modal: true,
          deactivate: function() {
            this.destroy(); //remove itself after close
          }
        }).data("kendoWindow");
        win.center().open();
        var dfd = $.Deferred();
        $div.find(":button").click(function() {
          win.close();
          if (this.className == "cnfrm-yes")
            dfd.resolve();
          else (this.className == "cnfrm-no")
            dfd.reject();          
        });
        return dfd.promise();
      };
    })(jQuery);
    
    function confirm(pid) {
      var dfd = 
        $.kendoConfirm(
          "請確認~",
          "確定要兌換嗎？？？?",
          "確定", "取消");
		dfd.done(function() { //按下Yes時
			exchange(pid)
        })
        .fail(function() { //按下No時
        });
	  }
	
	//檢查是否登入
	$(document).ready(function() { 
		$.ajax({
			type: "POST",
			url: "iflogin.php",
			data: {},
			dataType: 'html'
		}).done(function(data) {
			$('#nav').append(data);
			console.log(data);
		}).fail(function(jqXHR, textStatus, errorThrown) {
			alert("something wrong");
			console.log(jqXHR.responseText);
		});
	});
</script>
<body>
	<header class="main_menu_area " style="background-color: #000000a1;height: 15%">
		<nav class="navbar navbar-expand-lg navbar-secondary bg-secondary">
			<a class="navbar-brand" href="index.php"><img src="icon/Xprice.png" width="50%" alt=""></a>
			<button class="navbar-toggler " type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<i class="fas fa-sliders-h text-white fa-2x"></i>
			</button>

			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav" id='nav'>
					<li class="nav-item"><a class="nav-link" href="onsale.html">特價專區</a></li>
					<li class="nav-item"><a class="nav-link" href="map.html">搜尋店面</a></li>		
				</ul>
			</div>
		</nav>
	</header>
	<!-- 搜尋列 -->
	<form action='search.html' method="GET">
		<div>
			<div class="row align-items-center form-inline justify-content-center background" >
				<p class="col-12 text-center text-white h1 " style="font-family: 'Noto Serif TC', serif; padding-top: 8%">最便宜、最優惠的價格都在  Xprice</p>
				<p class="col-12 text-center h3 text-white"  style="font-family: 'Oswald', sans-serif;">Give you the cheapest price</p>
				<img src="icon/Xprice.png" width="10%" style="margin-right: 2% ">
				<input type="hidden" name='store_order' value=''>
				<input type="hidden" name='data_num' value=''>
				<input type="hidden" name='price_order' value=''>
				<input type="search"  name='search' class="form-control  col-md-7"  placeholder="想找什麼?">
				<button class="btn my-2 my-sm-0 btn" type="submit" style="margin-left: 2% ; background-color:#000000a1;color: #fff">Search</button>
			</div>
		</div>
	</form>
	<!-- 兌換中心 -->
	<div class="container pt-5">
		<div class="row justify-content-between justify-content-center align-items-end">
			<div class="col-md-4 col-10 align-items-center form-inline justify-content-start"  >
				<i class="fas fa-shopping-cart fa-5x"></i>
				<span class="ml-md-3" style="font-size: 40px;font-weight:bold;">兌換中心</span>
			</div>
			<div class="col-md-5 col-10 mt-5 bg-light border border-dark rounded m-3 height1 rounded-pill my-auto " id='personal_inform'>
				<!-- personal_inform here -->
			</div>
		</div>
	</div> 
	<div class="container border border-dark pt-5 " id='prize'>
		<!-- prize here -->
	</div> 
	<!-- 警告視窗 -->
	<div class='alert'></div>
	<!-- 確認列 -->
	<div class='dialog' style='display:none'>
		<div style='border: 1px solid blue; padding: 12px;'>
		<span class='m'></span>
		<input type='button' value='Yes' class="button text-center mt-4" style="padding-bottom:10%" />
		<input type='button' value='No' class="button text-center mt-4" style="padding-bottom:10%" />
		</div>
	</div> 

	<footer class="bg-dark  mt-5">
		<div class="container " >
		   	<div class="row align-items-center" style="padding: 5% 0">
			 	<div class="col-3 align-self-center text-center" >
			   		<img src="icon/Xprice.png" width="70%">
			 	</div>
			 <div class="col-5 text-white" style="font-family: 'Noto Serif TC', serif;">
				 <p class="my-3 h5"> <i class="fas fa-phone"></i>      Phone：07-1234567</p>
				 <h5 class="my-3 "> <i class="fas fa-map-marker-alt"></i>         Address：高雄市鼓山區蓮海路70號</h5>
				 <h5 class="my-3 "> <i class="fas fa-building"></i>      Department：中山資訊管理學系</h5>
			 </div>
			 <div class="col-4 text-white" style="font-family: 'Noto Serif TC', serif;">
				 <a class="mx-2 " href=""><i class="fab fa-instagram fa-5x" style="color: #e54372"></i></a>
				 <a class="mx-2" href=""><i class="fab fa-facebook fa-5x" style="color: #4267b5"></i></a>
				 <a class="mx-2" href=""><i class="fab fa-twitter fa-5x" style="color: #41abe1"></i></a>
			 </div>
		   </div>
		   
		 
		</div>
			 
	 </footer>
	 <footer>
	   <div class="row align-items-center justify-content-center" style="background-color: #1a1d1f">
			 <p class="text-center text-white " >©2020 By William、Homer、James、Park Seo Jun</p>
		   </div>
	 </footer>

	<script src="js/theme.js"></script> 
				
</body>
</html>